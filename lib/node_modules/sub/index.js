let electron = require('electron');
const ipcRenderer = electron.ipcRenderer;

const SubViewer = function()
{
    if (!(this instanceof SubViewer))
    {
        return new SubViewer();
    }
    this.current_illust_id = 0;
    this.viewer = document.body;
    this.title = document.getElementById('title');
    this.caption = document.getElementById('caption');
    this.tags = document.getElementById('tags-container');
    this.comments = document.getElementById('comment-list');
};

SubViewer.prototype.showCaption = function(innerHTML)
{
    this.caption.innerHTML = innerHTML;
};

let mainViewer = new SubViewer();

let parsePixiv = function(body)
{
    const parsedBody = (new DOMParser).parseFromString(body, 'text/html');
    {
        mainViewer.title.innerHTML = parsedBody.title;
        mainViewer.caption.innerText = parsedBody.head.querySelector('[property~="twitter:description"][content]').content
    }
};

let requestPixiv = function(illust_id)
{
    const request = new XMLHttpRequest();
    request.open('GET', ['https://www.pixiv.net/artworks/', illust_id].join(''));
    request.onload = function()
    {
        parsePixiv(request.responseText);
    };
    request.onerror = function()
    {
        console.error('通信エラー');
    };
    request.send();
};

ipcRenderer.on('illust_id', function(ev, message)
{
    console.log(message + '受け取った');
    if (mainViewer.current_illust_id === message)
    {
        return;
    }
    mainViewer.current_illust_id = message;
    requestPixiv(message);
});
